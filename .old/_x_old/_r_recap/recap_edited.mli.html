<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>recap_edited.mli</title>
<meta name="generator" content="emacs 25.3.1; htmlfontify 0.21" />
<style type="text/css"><!-- 
body { font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #000000;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.default   { font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #000000;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.default a { font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #000000;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.builtin   { color: #483d8b;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.builtin a { color: #483d8b;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.constant   { color: #008b8b;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.constant a { color: #008b8b;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.function-name   { color: #0000ff;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.function-name a { color: #0000ff;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.keyword   { color: #a020f0;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.keyword a { color: #a020f0;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.constructor   { font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #000000;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.constructor a { font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #000000;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.type   { color: #228b22;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.type a { color: #228b22;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.operator   { color: #a52a2a;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.operator a { color: #a52a2a;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.module   { color: #228b22;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.module a { color: #228b22;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.governing   { color: #000000;  font-weight: 700;  font-family: Ubuntu Mono;  font-stretch: normal;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.governing a { color: #000000;  font-weight: 700;  font-family: Ubuntu Mono;  font-stretch: normal;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.comment   { color: #b22222;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.comment a { color: #b22222;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
span.comment-delimiter   { color: #b22222;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: none; }
span.comment-delimiter a { color: #b22222;  font-family: Ubuntu Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #ffffff;  font-size: 10pt;  text-decoration: underline; }
 --></style>

    <script type="text/javascript"><!--
  // this function is needed to work around
  // a bug in IE related to element attributes
  function hasClass(obj)
  {
      var result = false;
      if (obj.getAttributeNode("class") != null)
      {
          result = obj.getAttributeNode("class").value;
      }
      return result;
  }

  function stripe(id)
  {
      // the flag we'll use to keep track of
      // whether the current row is odd or even
      var even = false;

      // if arguments are provided to specify the colors
      // of the even & odd rows, then use the them;
      // otherwise use the following defaults:
      var evenColor = arguments[1] ? arguments[1] : "#fff";
      var oddColor  = arguments[2] ? arguments[2] : "#ddd";

      // obtain a reference to the desired table
      // if no such table exists, abort
      var table = document.getElementById(id);
      if (! table) { return; }

      // by definition, tables can have more than one tbody
      // element, so we'll have to get the list of child
      // &lt;tbody&gt;s
      var tbodies = table.getElementsByTagName("tbody");

      // and iterate through them...
      for (var h = 0; h < tbodies.length; h++)
      {
          // find all the &lt;tr&gt; elements...
          var trs = tbodies[h].getElementsByTagName("tr");

          // ... and iterate through them
          for (var i = 0; i < trs.length; i++)
          {
              // avoid rows that have a class attribute
              // or backgroundColor style
              if (! hasClass(trs[i]) &&
                  ! trs[i].style.backgroundColor)
              {
                  // get all the cells in this row...
                  var tds = trs[i].getElementsByTagName("td");

                  // and iterate through them...
                  for (var j = 0; j < tds.length; j++)
                  {
                      var mytd = tds[j];

                      // avoid cells that have a class attribute
                      // or backgroundColor style
                      if (! hasClass(mytd) &&
                          ! mytd.style.backgroundColor)
                      {
                          mytd.style.backgroundColor =
                            even ? evenColor : oddColor;
                      }
                  }
              }
              // flip from odd to even, or vice-versa
              even =  ! even;
          }
      }
  }

  function toggle_invis( name )
  {
      var filter =
        { acceptNode:
          function( node )
          { var classname = node.id;
            if( classname )
            { var classbase = classname.substr( 0, name.length );
              if( classbase == name ) { return NodeFilter.FILTER_ACCEPT; } }
            return NodeFilter.FILTER_SKIP; } };
      var walker = document.createTreeWalker( document.body           ,
                                              NodeFilter.SHOW_ELEMENT ,
                                              filter                  ,
                                              false                   );
      while( walker.nextNode() )
      {
          var e = walker.currentNode;
          if( e.style.display == "none" ) { e.style.display = "inline"; }
          else                            { e.style.display = "none";   }
      }
  }
--> </script>
  </head>
  <body onload="stripe('index'); return true;">

<pre><span class="comment-delimiter">(* </span><span class="comment">This file likely generated by hand, based on tjr_btree_recap.mli,
   which is generated from tjr_btree_recap.ml. It includes main types
   but omits a lot of functions. </span><span class="comment-delimiter">*)</span>

<span class="governing">open </span><span class="module">Tjr_btree</span>
<span class="governing">open </span><span class="module">Block</span>
<span class="governing">open </span><span class="module">Frame</span>
<span class="governing">open </span><span class="module">Tree</span>
<span class="governing">open </span><span class="module">Rstk</span>
<span class="governing">open </span><span class="module">Monad</span>
<span class="governing">open </span><span class="module">Pre_map_ops</span>
<span class="governing">open </span><span class="module">Store_ops</span>

<span class="governing">module</span> <span class="governing">type</span> <span class="module">Blk_types</span> <span class="operator">=</span> <span class="governing">sig</span> <span class="governing">type</span> <span class="type">blk</span> <span class="governing">type</span> <span class="type">blk_id</span> <span class="operator">=</span> int <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Constants_type</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="type">t</span> <span class="operator">=</span>
      <span class="module">Constants.Constants_type.</span>t <span class="operator">=</span> <span class="operator">{</span>
      min_leaf_size <span class="operator">:</span> int<span class="operator">;</span>
      max_leaf_size <span class="operator">:</span> int<span class="operator">;</span>
      min_node_keys <span class="operator">:</span> int<span class="operator">;</span>
      max_node_keys <span class="operator">:</span> int<span class="operator">;</span>
    <span class="operator">}</span> <span class="operator">[@@</span>deriving yojson<span class="operator">]</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Frame_type</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> frame</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Disk_node.</span>dnode <span class="operator">=</span>
        <span class="constructor">Disk_node</span> <span class="keyword">of</span> <span class="operator">(</span>'k list <span class="operator">*</span> 'r list<span class="operator">)</span>
      <span class="operator">|</span> <span class="constructor">Disk_leaf</span> <span class="keyword">of</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list <span class="operator">[@@</span>deriving yojson<span class="operator">]</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Ls_state</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> ls_state</span> <span class="operator">=</span>
        <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Leaf_stream.</span>ls_state
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Params</span> <span class="operator">:</span>
  <span class="governing">sig</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">R2f</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> r2f</span> <span class="operator">=</span> 't <span class="operator">-&gt;</span> 'r <span class="operator">-&gt;</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> frame option
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">R2t</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> r2t</span> <span class="operator">=</span> 't <span class="operator">-&gt;</span> 'r <span class="operator">-&gt;</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">)</span> tree option
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Rstk</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> rstk</span> <span class="operator">=</span> <span class="operator">(</span>'k<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Tree_stack.</span>rstack
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Tree_type</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'a</span><span class="operator">,</span><span class="type"> 'b</span><span class="operator">)</span><span class="type"> tree</span> <span class="operator">=</span>
      <span class="operator">(</span>'a<span class="operator">,</span> 'b<span class="operator">)</span> <span class="module">Tree.</span>tree <span class="operator">=</span>
        <span class="constructor">Node</span> <span class="keyword">of</span> <span class="operator">(</span>'a list <span class="operator">*</span> <span class="operator">(</span>'a<span class="operator">,</span> 'b<span class="operator">)</span> tree list<span class="operator">)</span>
      <span class="operator">|</span> <span class="constructor">Leaf</span> <span class="keyword">of</span> <span class="operator">(</span>'a <span class="operator">*</span> 'b<span class="operator">)</span> list  <span class="operator">[@@</span>deriving yojson<span class="operator">]</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Disk_ops</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">module</span> <span class="module">Block_device_type</span> <span class="operator">=</span> <span class="module">Disk_ops.Block_device_type</span>
    <span class="governing">type</span> <span class="type">'t block_device</span> <span class="operator">=</span>
      't <span class="module">Block_device_type.</span>block_device <span class="operator">=</span> <span class="operator">{</span>
      blk_sz <span class="operator">:</span> blk_sz<span class="operator">;</span>
      read <span class="operator">:</span> blk_id <span class="operator">-&gt;</span> <span class="operator">(</span>blk<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      write <span class="operator">:</span> blk_id <span class="operator">-&gt;</span> blk <span class="operator">-&gt;</span> <span class="operator">(</span>unit<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
    <span class="operator">}</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Leaf_stream_ops</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">module</span> <span class="module">Leaf_stream_types</span> <span class="operator">=</span> <span class="module">Leaf_stream_ops.Leaf_stream_types</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> leaf_stream_state</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Leaf_stream_types.</span>leaf_stream_state <span class="operator">=</span> <span class="operator">{</span>
      kvs <span class="operator">:</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list<span class="operator">;</span>
      ls <span class="operator">:</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Ls_state.</span>ls_state<span class="operator">;</span>
    <span class="operator">}</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> lss</span> <span class="operator">=</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> leaf_stream_state
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> leaf_stream_ops</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">,</span> 't<span class="operator">)</span> <span class="module">Leaf_stream_types.</span>leaf_stream_ops <span class="operator">=</span> <span class="operator">{</span>
      mk_leaf_stream <span class="operator">:</span> unit <span class="operator">-&gt;</span> <span class="operator">((</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> lss<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      ls_step <span class="operator">:</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> lss <span class="operator">-&gt;</span> <span class="operator">((</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> lss option<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      ls_kvs <span class="operator">:</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> lss <span class="operator">-&gt;</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list<span class="operator">;</span>
    <span class="operator">}</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Map_ops</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">module</span> <span class="module">Map_ops_type</span> <span class="operator">=</span> <span class="module">Map_ops.Map_ops_type</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> map_ops</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 't<span class="operator">)</span> <span class="module">Map_ops_type.</span>map_ops <span class="operator">=</span> <span class="operator">{</span>
      find <span class="operator">:</span> 'k <span class="operator">-&gt;</span> <span class="operator">(</span>'v option<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      insert <span class="operator">:</span> 'k <span class="operator">-&gt;</span> 'v <span class="operator">-&gt;</span> <span class="operator">(</span>unit<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      delete <span class="operator">:</span> 'k <span class="operator">-&gt;</span> <span class="operator">(</span>unit<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      insert_many <span class="operator">:</span>
        'k <span class="operator">-&gt;</span> 'v <span class="operator">-&gt;</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list <span class="operator">-&gt;</span> <span class="operator">((</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
    <span class="operator">}</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Pre_map_ops</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">module</span> <span class="module">Pre_map_ops_type</span> <span class="operator">=</span> <span class="module">Pre_map_ops.Pre_map_ops_type</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> pre_map_ops</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">,</span> 't<span class="operator">)</span> <span class="module">Pre_map_ops_type.</span>pre_map_ops <span class="operator">=</span> <span class="operator">{</span>
      find_leaf <span class="operator">:</span> 'k <span class="operator">-&gt;</span> 'r <span class="operator">-&gt;</span>
        <span class="operator">(</span>'r <span class="operator">*</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list <span class="operator">*</span> <span class="operator">(</span>'k<span class="operator">,</span> 'r<span class="operator">)</span> rstk<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      find <span class="operator">:</span> 'k <span class="operator">-&gt;</span> 'r <span class="operator">-&gt;</span> <span class="operator">(</span>'r <span class="operator">*</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      insert <span class="operator">:</span> 'k <span class="operator">-&gt;</span> 'v <span class="operator">-&gt;</span> 'r <span class="operator">-&gt;</span> <span class="operator">(</span>'r<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      insert_many <span class="operator">:</span> 
        'k <span class="operator">-&gt;</span> 'v <span class="operator">-&gt;</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list <span class="operator">-&gt;</span> 
        'r <span class="operator">-&gt;</span> <span class="operator">(</span>'r <span class="operator">*</span> <span class="operator">(</span>'k <span class="operator">*</span> 'v<span class="operator">)</span> list<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      delete <span class="operator">:</span> 'k <span class="operator">-&gt;</span> 'r <span class="operator">-&gt;</span> <span class="operator">(</span>'r<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
    <span class="operator">}</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Store_ops</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> store_ops</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">,</span> 't<span class="operator">)</span> <span class="module">Store_ops.</span>store_ops <span class="operator">=</span> <span class="operator">{</span>
      store_free <span class="operator">:</span> 'r list <span class="operator">-&gt;</span> <span class="operator">(</span>unit<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      store_read <span class="operator">:</span> 'r <span class="operator">-&gt;</span> <span class="operator">((</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> frame<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
      store_alloc <span class="operator">:</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> frame <span class="operator">-&gt;</span> <span class="operator">(</span>'r<span class="operator">,</span> 't<span class="operator">)</span> m<span class="operator">;</span>
    <span class="operator">}</span>
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Small_step_types</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> find_state</span> <span class="operator">=</span>
        <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Find.</span>find_state
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> insert_state</span> <span class="operator">=</span>
        <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Insert.</span>insert_state
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> im_state</span> <span class="operator">=</span>
        <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Insert_many.</span>ist
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 'r</span><span class="operator">)</span><span class="type"> delete_state</span> <span class="operator">=</span>
        <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'r<span class="operator">)</span> <span class="module">Isa_export.Delete2.</span>delete_state
  <span class="governing">end</span>

<span class="governing">type</span> <span class="type">page_ref_int</span> <span class="operator">=</span> <span class="module">Page_ref_int.</span>page_ref

<span class="governing">module</span> <span class="module">Store_to_map</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="type">'t page_ref_ops</span> <span class="operator">=</span>
        <span class="operator">(</span>page_ref_int<span class="operator">,</span> 't<span class="operator">)</span> mref
    <span class="governing">val</span> <span class="function-name">store_ops_to_map_ops</span> <span class="operator">:</span>
      <span class="constant">ps</span><span class="operator">:&lt;</span> cmp <span class="operator">:</span> 'k <span class="operator">-&gt;</span> 'k <span class="operator">-&gt;</span> int<span class="operator">;</span> constants <span class="operator">:</span> <span class="module">Constants.</span>t<span class="operator">;</span> <span class="operator">..</span> <span class="operator">&gt;</span> <span class="operator">-&gt;</span>
      <span class="constant">page_ref_ops</span><span class="operator">:(</span>'a<span class="operator">,</span> 't<span class="operator">)</span> mref <span class="operator">-&gt;</span>
      <span class="constant">store_ops</span><span class="operator">:(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 'a<span class="operator">,</span> 't<span class="operator">)</span> store_ops <span class="operator">-&gt;</span> 
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> 't<span class="operator">)</span> <span class="module">Map_ops.</span>map_ops
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Disk_on_fd</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="type">fd</span> <span class="operator">=</span> <span class="module">Unix.</span>file_descr
    <span class="governing">type</span> <span class="type">'t fd_ops</span> <span class="operator">=</span> <span class="operator">(</span>fd<span class="operator">,</span> 't<span class="operator">)</span> mref
    <span class="governing">val</span> <span class="function-name">read</span> <span class="operator">:</span>
      <span class="constant">fd</span><span class="operator">:</span><span class="module">Unix.</span>file_descr <span class="operator">-&gt;</span>
      <span class="constant">blk_sz</span><span class="operator">:</span>blk_sz <span class="operator">-&gt;</span> 
      <span class="constant">blk_id</span><span class="operator">:</span>int <span class="operator">-&gt;</span> blk
    <span class="governing">val</span> <span class="function-name">write</span> <span class="operator">:</span>
      <span class="constant">fd</span><span class="operator">:</span><span class="module">Unix.</span>file_descr <span class="operator">-&gt;</span>
      blk_sz<span class="operator">:</span>int <span class="operator">-&gt;</span> 
      <span class="constant">blk_id</span><span class="operator">:</span>int <span class="operator">-&gt;</span> 
      <span class="constant">blk</span><span class="operator">:</span>blk <span class="operator">-&gt;</span> unit
    <span class="governing">val</span> <span class="function-name">safely_</span> <span class="operator">:</span> string <span class="operator">-&gt;</span> <span class="operator">(</span>'a<span class="operator">,</span> 't<span class="operator">)</span> m <span class="operator">-&gt;</span> <span class="operator">(</span>'a<span class="operator">,</span> 't<span class="operator">)</span> m
    <span class="governing">val</span> <span class="function-name">make_disk</span> <span class="operator">:</span>
      <span class="constant">blk_sz</span><span class="operator">:</span>blk_sz <span class="operator">-&gt;</span>
      <span class="constant">fd_ops</span><span class="operator">:(</span><span class="module">Unix.</span>file_descr<span class="operator">,</span> 't<span class="operator">)</span> mref <span class="operator">-&gt;</span>
      't <span class="module">Disk_ops.</span>block_device
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Disk_to_store</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="type">'t free_ops</span> <span class="operator">=</span> <span class="operator">(</span>int<span class="operator">,</span> 't<span class="operator">)</span> mref
    <span class="governing">val</span> <span class="function-name">disk_to_store</span> <span class="operator">:</span>
      <span class="constant">ps</span><span class="operator">:&lt;</span> blk_sz <span class="operator">:</span> int<span class="operator">;</span>
           frame_to_page <span class="operator">:</span> int <span class="operator">-&gt;</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> blk_id<span class="operator">)</span> frame <span class="operator">-&gt;</span> blk<span class="operator">;</span>
           page_to_frame <span class="operator">:</span> blk <span class="operator">-&gt;</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> page_ref_int<span class="operator">)</span> frame<span class="operator">;</span>
           <span class="operator">..</span> <span class="operator">&gt;</span> <span class="operator">-&gt;</span>
      <span class="constant">disk_ops</span><span class="operator">:</span>'t <span class="module">Disk_ops.</span>block_device <span class="operator">-&gt;</span>
      <span class="constant">free_ops</span><span class="operator">:(</span>blk_id<span class="operator">,</span> 't<span class="operator">)</span> mref <span class="operator">-&gt;</span> 
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">,</span> blk_id<span class="operator">,</span> 't<span class="operator">)</span> store_ops
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Mem_store</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">)</span><span class="type"> mem</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">)</span> <span class="module">Mem_store.</span>mem <span class="operator">=</span> <span class="operator">{</span>
      free <span class="operator">:</span> int<span class="operator">;</span>
      map <span class="operator">:</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">)</span> <span class="module">Page_ref_int.</span>frame <span class="module">Map_int.</span>t<span class="operator">;</span>
    <span class="operator">}</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> mem_ops</span> <span class="operator">=</span> <span class="operator">((</span>'k<span class="operator">,</span> 'v<span class="operator">)</span> mem<span class="operator">,</span> 't<span class="operator">)</span> mref
  <span class="governing">end</span>

<span class="governing">module</span> <span class="module">Cache</span> <span class="operator">:</span>
  <span class="governing">sig</span>
    <span class="governing">type</span> <span class="type">time</span> <span class="operator">=</span> int
    <span class="governing">type</span> <span class="type">dirty</span> <span class="operator">=</span> bool
    <span class="governing">module</span> <span class="module">Queue</span> <span class="operator">=</span> <span class="module">Map_int</span>
    <span class="governing">module</span> <span class="module">Pmap</span> <span class="operator">=</span> <span class="module">Cache.Pmap</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">)</span><span class="type"> cache_state</span> <span class="operator">=</span>
      <span class="operator">(</span>'k<span class="operator">,</span> 'v<span class="operator">)</span> <span class="module">Cache.</span>cache_state <span class="operator">=</span> <span class="operator">{</span>
      max_size <span class="operator">:</span> int<span class="operator">;</span>
      evict_count <span class="operator">:</span> int<span class="operator">;</span>
      current <span class="operator">:</span> time<span class="operator">;</span>
      map <span class="operator">:</span> <span class="operator">(</span>'k<span class="operator">,</span> 'v option <span class="operator">*</span> time <span class="operator">*</span> dirty<span class="operator">)</span> <span class="module">Pmap.</span>t<span class="operator">;</span>
      queue <span class="operator">:</span> 'k <span class="module">Queue.</span>t<span class="operator">;</span>
    <span class="operator">}</span>
    <span class="governing">type</span> <span class="operator">(</span><span class="type">'k</span><span class="operator">,</span><span class="type"> 'v</span><span class="operator">,</span><span class="type"> 't</span><span class="operator">)</span><span class="type"> cache_ops</span> <span class="operator">=</span>
        <span class="operator">((</span>'k<span class="operator">,</span> 'v<span class="operator">)</span> cache_state<span class="operator">,</span> 't<span class="operator">)</span> mref
    <span class="governing">val</span> <span class="function-name">make_cached_map</span> <span class="operator">:</span>
      <span class="constant">map_ops</span><span class="operator">:(</span>'a<span class="operator">,</span> 'b<span class="operator">,</span> 'c<span class="operator">)</span> <span class="module">Map_ops.</span>map_ops <span class="operator">-&gt;</span>
      <span class="constant">cache_ops</span><span class="operator">:((</span>'a<span class="operator">,</span> 'b<span class="operator">)</span> cache_state<span class="operator">,</span> 'c<span class="operator">)</span> mref <span class="operator">-&gt;</span>
      <span class="operator">(</span>cached_map_ops<span class="operator">:(</span>'a<span class="operator">,</span> 'b<span class="operator">,</span> 'c<span class="operator">)</span> <span class="module">Map_ops.</span>map_ops <span class="operator">-&gt;</span>
       <span class="constant">evict_hook</span><span class="operator">:(</span>unit <span class="operator">-&gt;</span> unit<span class="operator">)</span> <span class="builtin">ref</span> <span class="operator">-&gt;</span> 'd<span class="operator">)</span> <span class="operator">-&gt;</span>
      'd
  <span class="governing">end</span>
</pre>

 </body>
</html>
